# Contributing to LGH

æ„Ÿè°¢ä½ å¯¹ LGH çš„å…³æ³¨ï¼æˆ‘ä»¬æ¬¢è¿å„ç§å½¢å¼çš„è´¡çŒ®ã€‚

## ğŸš€ å¼€å§‹è´¡çŒ®

### 1. Fork å’Œå…‹éš†

```bash
# Fork æœ¬ä»“åº“ï¼Œç„¶åå…‹éš†ä½ çš„ fork
git clone https://github.com/YOUR_USERNAME/lgh.git
cd lgh
```

### 2. åˆ›å»ºåˆ†æ”¯

```bash
git checkout -b feature/your-feature-name
# æˆ–
git checkout -b fix/your-bug-fix
```

### 3. å¼€å‘

```bash
# å®‰è£…ä¾èµ–
go mod tidy

# æ„å»º
go build -o lgh ./cmd/lgh/

# è¿è¡Œæµ‹è¯•
go test ./... -v
```

### 4. æäº¤æ›´æ”¹

éµå¾ª [Conventional Commits](https://www.conventionalcommits.org/) è§„èŒƒï¼š

```bash
git commit -m "feat: add new tunnel method"
git commit -m "fix: handle empty repository list"
git commit -m "docs: update README with new examples"
git commit -m "security: fix password echo vulnerability"
```

### 5. æ¨é€å’Œåˆ›å»º PR

```bash
git push origin feature/your-feature-name
```

ç„¶ååœ¨ GitHub ä¸Šåˆ›å»º Pull Requestã€‚

## ğŸ“ ä»£ç è§„èŒƒ

### Go ä»£ç é£æ ¼

- ä½¿ç”¨ `gofmt` æ ¼å¼åŒ–ä»£ç 
- éµå¾ª [Effective Go](https://golang.org/doc/effective_go) æŒ‡å—
- ä¸ºå…¬å…±å‡½æ•°å’Œç±»å‹æ·»åŠ æ–‡æ¡£æ³¨é‡Š

### æäº¤è§„èŒƒ

- `feat:` æ–°åŠŸèƒ½
- `fix:` Bug ä¿®å¤
- `docs:` æ–‡æ¡£æ›´æ–°
- `test:` æµ‹è¯•ç›¸å…³
- `refactor:` ä»£ç é‡æ„
- `security:` å®‰å…¨ä¿®å¤
- `chore:` æ„å»º/å·¥å…·ç›¸å…³

## ğŸ”’ å®‰å…¨æ³¨æ„äº‹é¡¹

ä¸º LGH è´¡çŒ®ä»£ç æ—¶ï¼Œè¯·ç‰¹åˆ«æ³¨æ„ä»¥ä¸‹å®‰å…¨é—®é¢˜ï¼š

- **å¯†ç å¤„ç†**ï¼šå¯†ç å¿…é¡»ä½¿ç”¨éšè—è¾“å…¥ï¼Œä¸å¾—åœ¨ç»ˆç«¯å›æ˜¾
- **å¯†ç å­˜å‚¨**ï¼šåªå­˜å‚¨åŠ ç›å“ˆå¸Œï¼Œä¸å­˜å‚¨æ˜æ–‡
- **è·¯å¾„éªŒè¯**ï¼šæ–‡ä»¶æ“ä½œå‰å¿…é¡»éªŒè¯è·¯å¾„å®‰å…¨æ€§
- **æœ€å°æƒé™**ï¼šé…ç½®æ–‡ä»¶æƒé™åº”ä¸º 0600

å¦‚å‘ç°å®‰å…¨æ¼æ´ï¼Œè¯·ç§ä¸‹æŠ¥å‘Šï¼Œä¸è¦å…¬å¼€æŠ«éœ²ã€‚

## ğŸ§ª æµ‹è¯•

### è¿è¡Œæµ‹è¯•

```bash
# æ‰€æœ‰æµ‹è¯•
go test ./... -v

# çŸ­æµ‹è¯•ï¼ˆè·³è¿‡é›†æˆæµ‹è¯•ï¼‰
go test ./... -v -short

# å¸¦è¦†ç›–ç‡
go test ./... -v -cover

# å®‰å…¨æ£€æŸ¥
make security
```

### æµ‹è¯•è¦æ±‚

- æ–°åŠŸèƒ½å¿…é¡»åŒ…å«æµ‹è¯•
- Bug ä¿®å¤åº”è¯¥åŒ…å«å›å½’æµ‹è¯•
- å®‰å…¨ä¿®å¤å¿…é¡»åŒ…å«æµ‹è¯•éªŒè¯
- ä¿æŒæµ‹è¯•è¦†ç›–ç‡

## ï¿½ CI/CD æµç¨‹

æ‰€æœ‰ Pull Request å¿…é¡»é€šè¿‡ CI æ£€æŸ¥æ‰èƒ½åˆå¹¶ã€‚CI æµç¨‹åŒ…æ‹¬ä¸‰ä¸ªä¸»è¦é˜¶æ®µï¼š

### 1. ä»£ç æ£€æŸ¥ (Lint)

ä½¿ç”¨ `golangci-lint v1.60` è¿›è¡Œä»£ç è´¨é‡æ£€æŸ¥ï¼š

```bash
# æœ¬åœ°è¿è¡Œ lintï¼ˆæ¨èåœ¨æäº¤å‰è¿è¡Œï¼‰
make lint
# æˆ–
golangci-lint run
```

**å¿…é¡»é€šè¿‡çš„æ£€æŸ¥é¡¹ï¼š**
- âœ… `govet` - Go å®˜æ–¹é™æ€åˆ†æå·¥å…·ï¼ˆåŒ…æ‹¬ shadow æ£€æŸ¥ï¼‰
- âœ… `staticcheck` - é«˜çº§é™æ€åˆ†æ
- âœ… `gosimple` - ç®€åŒ–ä»£ç å»ºè®®
- âœ… `unused` - æœªä½¿ç”¨ä»£ç æ£€æµ‹
- âœ… `ineffassign` - ä½æ•ˆèµ‹å€¼æ£€æµ‹
- âœ… `gosec` - å®‰å…¨æ‰«æï¼ˆG104, G204, G304, G115 ç­‰ï¼‰
- âœ… `revive` - ä»£ç é£æ ¼æ£€æŸ¥
- âœ… `goimports` - Import æ’åºå’Œæ ¼å¼åŒ–ï¼ˆä½¿ç”¨ `github.com/JoeGlenn1213/lgh` ä½œä¸º local-prefixï¼‰
- âœ… `gofmt` - ä»£ç æ ¼å¼åŒ–
- âœ… `typecheck` - ç±»å‹æ£€æŸ¥

**å¸¸è§é—®é¢˜ä¿®å¤ï¼š**

1. **æœªä½¿ç”¨çš„å‚æ•°** (revive)ï¼š
   ```go
   // âŒ é”™è¯¯
   func runCommand(cmd *cobra.Command, args []string) error {
       // args æœªä½¿ç”¨
   }
   
   // âœ… æ­£ç¡®
   func runCommand(cmd *cobra.Command, _ []string) error {
       // ä½¿ç”¨ _ æ˜ç¡®è¡¨ç¤ºå¿½ç•¥
   }
   ```

2. **å˜é‡ shadowing** (govet)ï¼š
   ```go
   // âŒ é”™è¯¯
   err := doSomething()
   if err := doAnother(); err != nil {  // shadows outer err
       return err
   }
   
   // âœ… æ­£ç¡®
   err := doSomething()
   if err2 := doAnother(); err2 != nil {
       return err2
   }
   ```

3. **æœªå¤„ç†çš„é”™è¯¯** (gosec G104)ï¼š
   ```go
   // âŒ é”™è¯¯
   file.Close()
   
   // âœ… æ­£ç¡®
   _ = file.Close()  // æ˜ç¡®å¿½ç•¥
   // æˆ–
   if err := file.Close(); err != nil {
       log.Printf("failed to close: %v", err)
   }
   ```

4. **æ–‡ä»¶æƒé™é—®é¢˜** (gosec G306)ï¼š
   ```go
   // âŒ é”™è¯¯
   os.WriteFile(path, data, 0644)
   
   // âœ… æ­£ç¡®ï¼ˆæ•æ„Ÿæ–‡ä»¶ï¼‰
   os.WriteFile(path, data, 0600)
   ```

### 2. è®¸å¯è¯æ£€æŸ¥ (License Check)

ä½¿ç”¨ `addlicense` ç¡®ä¿æ‰€æœ‰æºä»£ç æ–‡ä»¶åŒ…å« MIT è®¸å¯è¯å¤´ï¼š

```bash
# æ·»åŠ è®¸å¯è¯å¤´
addlicense -l mit -c "JoeGlenn1213" **/*.go

# æ£€æŸ¥è®¸å¯è¯
addlicense -check -l mit -c "JoeGlenn1213" .
```

**è¦æ±‚ï¼š**
- æ‰€æœ‰ `.go` æ–‡ä»¶å¿…é¡»åŒ…å« MIT è®¸å¯è¯å¤´
- æ’é™¤ `dist/` å’Œ `vendor/` ç›®å½•

### 3. è·¨å¹³å°æµ‹è¯• (Test)

åœ¨ä¸‰ä¸ªå¹³å°ä¸Šè¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶ï¼š

**æµ‹è¯•å¹³å°ï¼š**
- ğŸ§ Ubuntu (latest)
- ğŸ macOS (latest) 
- ğŸªŸ Windows (latest)

**æµ‹è¯•å‘½ä»¤ï¼š**
```bash
# Linux: è¿è¡Œæ‰€æœ‰æµ‹è¯• + race detector
go test ./... -v -race

# macOS/Windows: è¿è¡Œæ‰€æœ‰æµ‹è¯•ï¼ˆæ—  race detectorï¼‰
go test ./... -v
```

**æµ‹è¯•è¦æ±‚ï¼š**
- âœ… æ‰€æœ‰é›†æˆæµ‹è¯•å¿…é¡»é€šè¿‡
- âœ… æµ‹è¯•å¿…é¡»åœ¨ 5 åˆ†é’Ÿå†…å®Œæˆ
- âœ… è·¨å¹³å°å…¼å®¹æ€§ï¼ˆUnix/Windows è·¯å¾„å¤„ç†ï¼‰
- âœ… æ­£ç¡®è®¾ç½®ç¯å¢ƒå˜é‡ï¼ˆ`HOME` å’Œ `USERPROFILE`ï¼‰

### CI é…ç½®æ–‡ä»¶

å®Œæ•´çš„ CI é…ç½®è§ [`.github/workflows/ci.yml`](.github/workflows/ci.yml)

### æœ¬åœ°éªŒè¯æµç¨‹

åœ¨æäº¤ PR å‰ï¼Œè¯·ç¡®ä¿æœ¬åœ°é€šè¿‡æ‰€æœ‰æ£€æŸ¥ï¼š

```bash
# 1. æ ¼å¼åŒ–ä»£ç 
go fmt ./...
goimports -local github.com/JoeGlenn1213/lgh -w .

# 2. è¿è¡Œ linter
golangci-lint run

# 3. è¿è¡Œæµ‹è¯•
go test ./... -v

# 4. ï¼ˆå¯é€‰ï¼‰è¿è¡Œ race detector
go test ./... -v -race

# 5. æ£€æŸ¥è®¸å¯è¯
addlicense -check -l mit -c "JoeGlenn1213" .
```

### CI å¤±è´¥å¤„ç†

å¦‚æœ CI å¤±è´¥ï¼š

1. **æŸ¥çœ‹æ—¥å¿—**ï¼šç‚¹å‡»å¤±è´¥çš„æ£€æŸ¥æŸ¥çœ‹è¯¦ç»†é”™è¯¯ä¿¡æ¯
2. **æœ¬åœ°ä¿®å¤**ï¼šåœ¨æœ¬åœ°è¿è¡Œç›¸åŒçš„å‘½ä»¤é‡ç°é—®é¢˜
3. **ä¿®å¤å¹¶æ¨é€**ï¼šä¿®å¤åæ¨é€åˆ°åŒä¸€ PR åˆ†æ”¯ï¼ŒCI ä¼šè‡ªåŠ¨é‡æ–°è¿è¡Œ
4. **å¯»æ±‚å¸®åŠ©**ï¼šå¦‚æœé‡åˆ°å›°éš¾ï¼Œåœ¨ PR ä¸­è¯„è®ºè¯´æ˜é—®é¢˜

### æ€§èƒ½å’Œç¨³å®šæ€§è¦æ±‚

- æµ‹è¯•ä¸åº”è¯¥æœ‰ flakyï¼ˆä¸ç¨³å®šï¼‰è¡Œä¸º
- é›†æˆæµ‹è¯•åº”è¯¥æ­£ç¡®æ¸…ç†ä¸´æ—¶æ–‡ä»¶
- ä½¿ç”¨å”¯ä¸€çš„ä¸´æ—¶ç›®å½•é¿å…å†²çª
- Windows è·¯å¾„å¤„ç†ä½¿ç”¨ `filepath.ToSlash()` è½¬æ¢

## ï¿½ğŸ“‹ Issue æŒ‡å—

### æŠ¥å‘Š Bug

è¯·åŒ…å«ä»¥ä¸‹ä¿¡æ¯ï¼š

- LGH ç‰ˆæœ¬ (`lgh --version`)
- æ“ä½œç³»ç»Ÿå’Œç‰ˆæœ¬
- å¤ç°æ­¥éª¤
- é¢„æœŸè¡Œä¸º
- å®é™…è¡Œä¸º
- ç›¸å…³æ—¥å¿—

### æŠ¥å‘Šå®‰å…¨é—®é¢˜

**ä¸è¦åœ¨å…¬å¼€ Issue ä¸­æŠ¥å‘Šå®‰å…¨æ¼æ´ï¼**

è¯·å‘é€é‚®ä»¶è‡³é¡¹ç›®ç»´æŠ¤è€…ï¼ŒåŒ…å«ï¼š
- æ¼æ´æè¿°
- å¤ç°æ­¥éª¤
- æ½œåœ¨å½±å“

### åŠŸèƒ½è¯·æ±‚

è¯·æè¿°ï¼š

- ä½ æƒ³è§£å†³çš„é—®é¢˜
- ä½ æè®®çš„è§£å†³æ–¹æ¡ˆ
- å¯èƒ½çš„æ›¿ä»£æ–¹æ¡ˆ

## ğŸ—ï¸ é¡¹ç›®ç»“æ„

```
lgh/
â”œâ”€â”€ cmd/lgh/           # CLI å‘½ä»¤
â”‚   â”œâ”€â”€ main.go       # å…¥å£ç‚¹
â”‚   â”œâ”€â”€ init.go       # lgh init
â”‚   â”œâ”€â”€ serve.go      # lgh serve
â”‚   â”œâ”€â”€ add.go        # lgh add
â”‚   â”œâ”€â”€ list.go       # lgh list
â”‚   â”œâ”€â”€ status.go     # lgh status
â”‚   â”œâ”€â”€ remove.go     # lgh remove
â”‚   â”œâ”€â”€ tunnel.go     # lgh tunnel
â”‚   â””â”€â”€ auth.go       # lgh auth (è®¤è¯ç®¡ç†)
â”œâ”€â”€ internal/          # å†…éƒ¨åŒ…
â”‚   â”œâ”€â”€ config/       # é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ git/          # Git æ“ä½œ
â”‚   â”œâ”€â”€ registry/     # ä»“åº“æ˜ å°„
â”‚   â”œâ”€â”€ server/       # HTTP æœåŠ¡å™¨ + è®¤è¯ä¸­é—´ä»¶
â”‚   â”œâ”€â”€ tunnel/       # éš§é“åŠŸèƒ½
â”‚   â””â”€â”€ mdns/         # mDNS æœåŠ¡
â”œâ”€â”€ pkg/ui/           # ç»ˆç«¯ UI
â”œâ”€â”€ docs/             # æ–‡æ¡£
â”‚   â””â”€â”€ SECURITY.md   # å®‰å…¨æŒ‡å—
â””â”€â”€ test/             # é›†æˆæµ‹è¯•
```

## âœ… PR Checklist

- [ ] ä»£ç é€šè¿‡ `go fmt` å’Œ `go vet`
- [ ] æ‰€æœ‰æµ‹è¯•é€šè¿‡
- [ ] æ·»åŠ äº†å¿…è¦çš„æµ‹è¯•
- [ ] æ›´æ–°äº†ç›¸å…³æ–‡æ¡£
- [ ] æäº¤ä¿¡æ¯éµå¾ªè§„èŒƒ
- [ ] å®‰å…¨æ•æ„Ÿä»£ç å·²å®¡æŸ¥

## ğŸ“„ License

é€šè¿‡è´¡çŒ®ä»£ç ï¼Œä½ åŒæ„ä½ çš„è´¡çŒ®å°†æŒ‰ç…§ MIT è®¸å¯è¯æˆæƒã€‚

---

å†æ¬¡æ„Ÿè°¢ä½ çš„è´¡çŒ®ï¼å¦‚æœ‰é—®é¢˜ï¼Œè¯·éšæ—¶æå‡º Issueã€‚
